<script>
import vegaBaseMixin from '@/mixins/vega-base-mixin.js';

export default {
  mixins: [vegaBaseMixin],
  props: {
    variable: {
      type: String,
      required: true,
    },
    station: {
      type: String,
      required: true,
    },
    x: {
      type: String,
      required: true,
    },
    xTitle: {
      type: String,
      required: false,
      default: 'Month/Year',
    },
    xUnit: {
      type: String,
      required: false,
      default: 'month',
    },
    y: {
      type: String,
      required: true,
    },
    yTitle: {
      type: String,
      required: false,
      default: 'Buoy',
    },
    height: {
      type: Number,
      required: false,
      default: 300,
    },
  },
  computed: {
    baseSpec() {
      return {
        $schema: 'https://vega.github.io/schema/vega/v5.json',
        height: this.height,
        data: [
          {
            name: 'rawData',
            values: this.dataset,
          },
          {
            name: 'data',
            source: 'rawData',
            transform: [
              { type: 'filter', expr: `datum.station == "${this.station}"` },
              { type: 'filter', expr: 'datum.abun != 0' },
            ],
          },
        ],
        scales: [
          {
            name: 'x',
            type: 'utc',
            domain: { data: 'rawData', field: this.x },
            range: 'width',
          },
          {
            name: 'y',
            type: 'band',
            domain: { data: 'data', field: this.y },
            range: 'height',
            padding: 0.02,
          },
          {
            name: 'color',
            type: 'log',
            range: { scheme: 'tealblues' },
            domain: { data: 'data', field: this.variable },
            reverse: false,
            zero: false,
            nice: true,
          },
          {
            name: 'size',
            type: 'log',
            domain: { data: 'data', field: this.variable },
            range: [0, 50],
          },
          {
            name: 'shape',
            type: 'ordinal',
            domain: ['fish', 'notfish'],
            range: [
              'm4 3c-1.125 0-2.107.685-2.653 1.27v0l-1.092-.826c-.152-.115-.378.008-.339.183v0l.302 1.372-.302 1.372c-.039.176 .188.298 .339.183v0l1.092-.826c.547.586 1.529 1.27 2.654 1.27 1.718 0 3.111-1.6 3.111-2 0-.4-1.393-2-3.111-2zm1.093 2.3c-.166 0-.3-.134-.3-.3 0-.166.134-.3.3-.3.166 0 .3.134 .3.3 0 .166-.134.3-.3.3z',
              // 'M 5 3 C 3.875 3 2.893 3.685 2.347 4.27 V 4.27 L 1.255 3.444 C 1.103 3.329 0.877 3.452 0.916 3.627 V 3.627 L 1.218 4.999 L 0.916 6.371 C 0.877 6.547 1.104 6.669 1.255 6.554 V 6.554 L 2.347 5.728 C 2.894 6.314 3.876 6.998 5.001 6.998 C 6.719 6.998 8.112 5.398 8.112 4.998 C 8.112 4.598 6.719 2.998 5.001 2.998 Z M 6.093 5.3 C 5.927 5.3 5.793 5.166 5.793 5 C 5.793 4.834 5.927 4.7 6.093 4.7 C 6.259 4.7 6.393 4.834 6.393 5 C 6.393 5.166 6.259 5.3 6.093 5.3 Z',
              // 'M4440 6760 c-539 -51 -1086 -229 -1586 -515 -1045 -600 -2042 -1754 -2735 -3169 -93 -191 -119 -251 -118 -282 1 -37 9 -46 157 -186 762 -714 1665 -1291 2515 -1607 448 -167 1139 -324 1697 -387 191 -22 601 -29 790 -15 771 59 1515 311 2490 844 553 302 1160 701 1899 1251 118 87 220 159 226 160 6 1 243 -267 525 -594 283 -327 825 -955 1205 -1395 379 -439 695 -806 702 -815 11 -13 22 -10 97 30 47 25 86 50 86 57 0 6 -13 63 -29 125 -134 522 -232 1128 -283 1743 -16 196 -15 823 1 980 45 441 141 865 313 1395 76 235 130 381 281 760 120 302 121 306 125 399 4 88 3 94 -14 89 -156 -45 -140 -35 -223 -132 -213 -247 -1121 -1048 -1946 -1717 -230 -186 -640 -511 -754 -596 l-54 -41 -108 152 c-634 888 -1486 1786 -2249 2368 -825 628 -1592 980 -2365 1083 -142 19 -511 27 -645 15z',
              'M4 -2c0 0 0.9 -0.7 1.1 -0.8c0.1 -0.1 -0.1 0.5 -0.3 0.7c-0.2 0.2 1.1 1.1 1.1 1.2c0 0.2 -0.2 0.8 -0.4 0.7c-0.1 0 -0.8 -0.3 -1.3 -0.2c-0.5 0.1 -1.3 1.6 -1.5 2c-0.3 0.4 -0.6 0.4 -0.6 0.4c0 0.1 0.3 1.7 0.4 1.8c0.1 0.1 -0.4 0.1 -0.5 0c0 0 -0.6 -1.9 -0.6 -1.9c-0.1 0 -0.3 -0.1 -0.3 -0.1c0 0.1 -0.5 1.4 -0.4 1.6c0.1 0.2 0.1 0.3 0.1 0.3c0 0 -0.4 0 -0.4 0c0 0 -0.2 -0.1 -0.1 -0.3c0 -0.2 0.3 -1.7 0.3 -1.7c0 0 -2.8 -0.9 -2.9 -0.8c-0.2 0.1 -0.4 0.6 -0.4 1c0 0.4 0.5 1.9 0.5 1.9l-0.5 0l-0.6 -2l0 -0.6c0 0 -1 0.8 -1 1c0 0.2 -0.2 1.3 -0.2 1.3c0 0 0.3 0.3 0.2 0.3c0 0 -0.5 0 -0.5 0c0 0 -0.2 -0.2 -0.1 -0.4c0 -0.1 0.2 -1.6 0.2 -1.6c0 0 0.5 -0.4 0.5 -0.5c0 -0.1 0 -2.7 -0.2 -2.7c-0.1 0 -0.4 2 -0.4 2c0 0 0 0.2 -0.2 0.5c-0.1 0.4 -0.2 1.1 -0.2 1.1c0 0 -0.2 -0.1 -0.2 -0.2c0 -0.1 -0.1 -0.7 0 -0.7c0.1 -0.1 0.3 -0.8 0.4 -1.4c0 -0.6 0.2 -1.3 0.4 -1.5c0.1 -0.2 0.6 -0.4 0.6 -0.4z',
              // 'M327.1 96c-89.97 0-168.54 54.77-212.27 101.63L27.5 131.58c-12.13-9.18-30.24.6-27.14 14.66L24.54 256 .35 365.77c-3.1 14.06 15.01 23.83 27.14 14.66l87.33-66.05C158.55 361.23 237.13 416 327.1 416 464.56 416 576 288 576 256S464.56 96 327.1 96zm87.43 184c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24 13.26 0 24 10.74 24 24 0 13.25-10.75 24-24 24z',
              'M1.7 -1.7h-0.8c0.3 -0.2 0.6 -0.5 0.6 -0.9c0 -0.6 -0.4 -1 -1 -1c-0.6 0 -1 0.4 -1 1c0 0.4 0.2 0.7 0.6 0.9h-0.8c-0.4 0 -0.7 0.3 -0.7 0.6v1.9c0 0.3 0.3 0.6 0.6 0.6h0.2c0 0 0 0.1 0 0.1v1.9c0 0.3 0.2 0.6 0.3 0.6h1.3c0.2 0 0.3 -0.3 0.3 -0.6v-1.8c0 0 0 -0.1 0 -0.1h0.2c0.3 0 0.6 -0.3 0.6 -0.6v-2c0.2 -0.3 -0.1 -0.6 -0.4 -0.6z',
              // 'M431.503,214.091c-13.844-35.103-36.991-65.519-66.941-87.96c-30.127-22.573-65.671-35.893-102.892-38.575l-76.768-38.814c-0.151-0.077-0.306-0.149-0.462-0.216c-3.47-1.485-7.017-2.237-10.543-2.237c-14.239,0-24.978,11.991-24.978,27.892c0,10.259,4.691,19.05,10.124,29.228c0.684,1.282,1.377,2.581,2.075,3.908c-32.079,15.982-59.87,41.013-79.482,71.591l-52.46-32.163c-0.331-0.203-0.677-0.381-1.034-0.535c-2.722-1.165-5.516-1.755-8.304-1.755C8.528,144.454,0,153.856,0,166.324c0,14.541,16.277,39.445,24.2,50.704C16.277,228.286,0,253.19,0,267.731c0,12.468,8.528,21.87,19.838,21.87c2.788,0,5.583-0.591,8.306-1.756c0.356-0.153,0.702-0.332,1.033-0.534l52.455-32.159c19.558,30.612,46.449,54.973,78.465,71.083c-0.529,1.035-1.053,2.053-1.571,3.059c-5.154,10.002-9.605,18.641-9.605,28.586c0,15.899,10.737,27.89,24.977,27.891c0.001,0,0.002,0,0.003,0c3.524,0,7.071-0.753,10.541-2.238c0.164-0.07,0.326-0.146,0.484-0.227l71.589-36.48c77.367-3.531,145.924-53.162,174.989-126.865C432.246,218.075,432.246,215.977,431.503,214.091zM322.279,314.593c-22.115-23.023-35.251-59.884-35.251-99.28c0-18.159,2.696-35.639,8.013-51.953c1.369-4.201-0.927-8.716-5.128-10.085c-4.199-1.366-8.716,0.926-10.085,5.127c-5.839,17.918-8.8,37.065-8.8,56.911c0,40.908,13.128,79.621,35.47,105.676c-16.634,5.839-34.237,9.262-52.351,9.921c-1.163,0.042-2.304,0.338-3.341,0.867l-72.881,37.139c-1.392,0.568-2.745,0.856-4.027,0.856c0,0,0,0-0.001,0c-5.202,0-8.978-5.001-8.978-11.891c0-6.066,3.283-12.438,7.828-21.258c1.637-3.177,3.492-6.778,5.344-10.689c0.917-1.939,1.018-4.167,0.278-6.181c-0.74-2.014-2.258-3.646-4.213-4.531c-34.721-15.705-63.414-41.679-82.976-75.116c-1.086-1.856-2.873-3.197-4.959-3.72c-0.643-0.161-1.295-0.24-1.946-0.24c-1.463,0-2.912,0.402-4.182,1.18l-58.691,35.982c-0.556,0.195-1.081,0.293-1.565,0.293c-2.26,0-3.838-2.414-3.838-5.87c0-8.872,14.32-32.206,24.489-45.942c2.094-2.828,2.094-6.694,0-9.522C30.32,198.531,16,175.196,16,166.324c0-3.457,1.578-5.87,3.839-5.87c0.484,0,1.009,0.098,1.565,0.292l58.689,35.982c1.833,1.125,4.042,1.462,6.128,0.939s3.873-1.864,4.959-3.72c19.498-33.326,49.344-60.172,84.041-75.594c1.979-0.879,3.516-2.522,4.262-4.555c0.745-2.032,0.636-4.28-0.305-6.23c-2.07-4.294-4.168-8.226-6.02-11.694c-4.783-8.962-8.239-15.438-8.239-21.695c0-6.891,3.775-11.892,8.978-11.892c1.285,0,2.644,0.289,4.039,0.859l77.963,39.418c0.966,0.489,2.021,0.776,3.103,0.845c15.503,0.985,30.701,3.987,45.277,8.875c-3.864,4.778-7.465,9.967-10.75,15.523c-2.248,3.803-0.988,8.709,2.815,10.958c1.277,0.756,2.68,1.115,4.063,1.115c2.735,0,5.401-1.404,6.895-3.93c3.822-6.464,8.103-12.343,12.751-17.526c12.271,5.459,23.981,12.317,34.914,20.509c26.739,20.035,47.596,46.987,60.466,78.091C397.18,261.144,363.465,295.576,322.279,314.593z',
            ],
          },
        ],
        axes: [
          {
            orient: 'bottom',
            scale: 'x',
            domain: false,
            title: this.xTitle,
            labelOverlap: 'parity',
          },
          {
            orient: 'left',
            scale: 'y',
            domain: false,
            title: this.yTitle,
          },
        ],
        legends: [
          {
            title: ['Abundance of', 'Fish (log)'],
            fill: 'color',
            type: 'gradient',
            gradientLength: { signal: 'height' },
          },
        ],
        marks: [
          {
            type: 'symbol',
            from: { data: 'data' },
            encode: {
              enter: {
                x: { scale: 'x', field: this.x },
                y: { scale: 'y', field: this.y },
                height: { scale: 'y', band: 1 },
                width: {
                  signal: `scale('x', timeOffset('${this.xUnit}', now())) - scale('x', now())`,
                },
                tooltip: {
                  signal: `{'Date': utcFormat(datum.${this.x}, '%B %Y'), '${this.yTitle}': datum.${this.y}, 'Count': datum.${this.variable}}`,
                },
              },
              update: {
                fill: { scale: 'color', field: this.variable },
                size: { scale: 'size', field: this.variable },
                shape: { scale: 'shape', field: 'animal' },
              },
            },
          },
        ],
      };
    },
  },
};
</script>

<style lang="scss" scoped></style>
