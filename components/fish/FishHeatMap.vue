<script>
import vegaBaseMixin from '@/mixins/vega-base-mixin.js';

export default {
  mixins: [vegaBaseMixin],
  props: {
    variable: {
      type: String,
      required: true,
    },
    station: {
      type: String,
      required: true,
    },
    x: {
      type: String,
      required: true,
    },
    xTitle: {
      type: String,
      required: false,
      default: 'Month/Year',
    },
    xUnit: {
      type: String,
      required: false,
      default: 'month',
    },
    y: {
      type: String,
      required: true,
    },
    yTitle: {
      type: String,
      required: false,
      default: 'Buoy',
    },
    height: {
      type: Number,
      required: false,
      default: 300,
    },
  },
  computed: {
    baseSpec() {
      return {
        $schema: 'https://vega.github.io/schema/vega/v5.json',
        height: this.height,
        data: [
          {
            name: 'rawData',
            values: this.dataset,
          },
          {
            name: 'data',
            source: 'rawData',
            transform: [
              {
                type: 'collect',
                sort: {
                  field: ['species', 'year'],
                  order: ['ascending', 'ascending'],
                },
              },
              {
                type: 'filter',
                expr: `datum.station == "${this.station}"`,
              },
              { type: 'filter', expr: 'datum.abun != 0' },
            ],
          },
        ],
        scales: [
          {
            name: 'x',
            type: 'band',
            domain: { data: 'data', field: 'year' },
            range: 'width',
          },
          {
            name: 'y',
            type: 'band',
            domain: { data: 'data', field: this.y },
            range: 'height',
            padding: 0.02,
          },
          {
            name: 'color',
            type: 'log',
            range: { scheme: 'tealblues' },
            domain: { data: 'data', field: this.variable },
            reverse: false,
            zero: false,
            nice: true,
          },
          {
            name: 'size',
            type: 'log',
            domain: { data: 'data', field: 'abun' },
            range: [0.1, 1],
          },
          {
            name: 'shape',
            type: 'ordinal',
            domain: ['fish', 'lobster', 'crab', 'starfish', 'squid'],
            range: [
              'm4 3c-1.125 0-2.107.685-2.653 1.27v0l-1.092-.826c-.152-.115-.378.008-.339.183v0l.302 1.372-.302 1.372c-.039.176 .188.298 .339.183v0l1.092-.826c.547.586 1.529 1.27 2.654 1.27 1.718 0 3.111-1.6 3.111-2 0-.4-1.393-2-3.111-2zm1.093 2.3c-.166 0-.3-.134-.3-.3 0-.166.134-.3.3-.3.166 0 .3.134 .3.3 0 .166-.134.3-.3.3z',
              'M 4.6658 2.4731 c 0.6273 -0.1337 1.0966 -0.7424 1.0966 -1.2731 c 0 -1.05 -0.6 -1.2 -0.6 -1.2 c 0 1.075 -0.2882 1.2843 -0.3 1.3 V 0.45 c -0.75 0.15 -0.75 1.45 -0.75 1.75 c 0 0.1112 -0.0812 0.2036 -0.1874 0.2216 c -0.0866 -0.6623 -0.3087 -1.077 -0.5059 -1.3246 c 0.0866 -0.0947 0.1873 -0.2588 0.2265 -0.5284 c 0.0988 -0.0491 0.1669 -0.1507 0.1669 -0.2685 c 0 -0.1657 -0.1343 -0.3 -0.3 -0.3 c -0.1657 0 -0.3 0.1343 -0.3 0.3 c 0 0.1037 0.0526 0.195 0.1326 0.2489 c -0.0287 0.1713 -0.0876 0.2735 -0.1347 0.3306 c -0.0883 -0.0747 -0.1478 -0.1046 -0.1478 -0.1046 s -0.0595 0.0299 -0.1478 0.1046 c -0.0471 -0.0571 -0.106 -0.1593 -0.1347 -0.3306 c 0.08 -0.0539 0.1326 -0.1453 0.1326 -0.2489 c 0 -0.1657 -0.1343 -0.3 -0.3 -0.3 c -0.1657 0 -0.3 0.1343 -0.3 0.3 c 0 0.1178 0.0681 0.2195 0.1669 0.2685 c 0.0391 0.2697 0.1399 0.4338 0.2265 0.5284 c -0.1972 0.2476 -0.4193 0.6623 -0.5059 1.3246 c -0.1062 -0.018 -0.1874 -0.1104 -0.1874 -0.2216 c 0 -0.3 0 -1.6 -0.75 -1.75 v 0.85 c -0.0118 -0.0157 -0.3 -0.225 -0.3 -1.3 c 0 0 -0.6 0.15 -0.6 1.2 c 0 0.5307 0.4693 1.1394 1.0966 1.2731 c 0.105 0.2985 0.377 0.5188 0.7034 0.5484 c 0 0.0012 -0 0.0024 -0 0.0036 v 0.225 h -0.315 c -0.2068 0 -0.375 -0.1682 -0.375 -0.375 h -0.3 c 0 0.3722 0.3028 0.675 0.675 0.675 h 0.315 v 0.225 h -0.315 c -0.3722 0 -0.675 0.3028 -0.675 0.675 h 0.3 c 0 -0.2068 0.1682 -0.375 0.375 -0.375 h 0.315 c 0 0.1214 0.0482 0.2315 0.1264 0.3125 c -0.0782 0.081 -0.1264 0.1911 -0.1264 0.3125 c 0 0.1562 0.0796 0.2937 0.2003 0.3744 L 2.0125 5.775 c 0 0 0.2882 0.35 1.05 0.35 c 0.7618 0 1.05 -0.35 1.05 -0.35 l -0.3503 -0.7006 c 0.1208 -0.0807 0.2003 -0.2182 0.2003 -0.3744 c 0 -0.1214 -0.0482 -0.2315 -0.1264 -0.3125 c 0.0782 -0.081 0.1264 -0.1911 0.1264 -0.3125 h 0.315 c 0.2068 0 0.375 0.1682 0.375 0.375 h 0.3 c 0 -0.3722 -0.3028 -0.675 -0.675 -0.675 h -0.315 v -0.225 h 0.315 c 0.3722 0 0.675 -0.3028 0.675 -0.675 h -0.3 c 0 0.2068 -0.1682 0.375 -0.375 0.375 h -0.315 v -0.225 c 0 -0.0012 -0 -0.0024 -0 -0.0036 C 4.2888 2.9919 4.5608 2.7716 4.6658 2.4731 z',
              'M 6.8 3.6504 c 0 0.276 -0.224 0.5 -0.5 0.5 h -0.3592 c -0.0696 -0.2288 -0.1968 -0.4416 -0.3704 -0.628 c 0.1664 -0.128 0.2952 -0.3024 0.3664 -0.504 C 6.7328 2.8616 7.2 2.156 7.2 1.4496 C 7.2 0.6504 6.6 0.4504 6.6 0.4504 c 0 0.6 -0.4 1 -0.4 1 v -0.8 c -1 0.2 -1 1.6 -1 2 c 0 0.1656 -0.1344 0.3 -0.3 0.3 h -0.2 c -0.1304 -0.0504 -0.2688 -0.0928 -0.412 -0.1248 c 0.0536 -0.1384 0.0944 -0.3112 0.1072 -0.5264 c 0.1216 -0.0688 0.2048 -0.1992 0.2048 -0.3488 c 0 -0.2208 -0.1792 -0.4 -0.4 -0.4 c -0.2208 0 -0.4 0.1792 -0.4 0.4 c 0 0.1456 0.0784 0.2728 0.1952 0.3432 c -0.0152 0.2136 -0.0632 0.3648 -0.116 0.4696 c -0.0912 -0.008 -0.1848 -0.012 -0.2792 -0.012 s -0.1872 0.004 -0.2792 0.012 c -0.0528 -0.1048 -0.1008 -0.2552 -0.116 -0.4696 c 0.1168 -0.0696 0.1952 -0.1968 0.1952 -0.3432 c 0 -0.2208 -0.1792 -0.4 -0.4 -0.4 c -0.2208 0 -0.4 0.1792 -0.4 0.4 c 0 0.1496 0.0824 0.28 0.2048 0.3488 c 0.0128 0.2152 0.0536 0.388 0.1072 0.5264 c -0.1432 0.032 -0.2816 0.0744 -0.412 0.1248 H 2.3 c -0.1656 0 -0.3 -0.1344 -0.3 -0.3 c 0 -0.4 0 -1.8 -1 -2 v 0.8 c 0 0 -0.4 -0.4 -0.4 -1 c 0 0 -0.6 0.2 -0.6 1 c 0 0.7056 0.4672 1.4112 1.2632 1.568 c 0.072 0.2016 0.2008 0.376 0.3664 0.504 c -0.1736 0.1864 -0.3016 0.3992 -0.3704 0.628 H 0.9 c -0.276 0 -0.5 -0.224 -0.5 -0.5 v -0.5 H 0 v 0.5 c 0 0.496 0.404 0.9 0.9 0.9 h 0.3 c 0 0.1376 0.0208 0.2712 0.0592 0.4 H 0.9 c -0.496 0 -0.9 0.404 -0.9 0.9 v 0.5 h 0.4 v -0.5 c 0 -0.276 0.224 -0.5 0.5 -0.5 h 0.5496 c 0.0552 0.0832 0.1184 0.1632 0.1896 0.2384 C 1.2696 5.7008 1 6.044 1 6.4504 v 0.3 h 0.4 v -0.3 c 0 -0.276 0.224 -0.5 0.5 -0.5 h 0.192 c 0.412 0.2504 0.9368 0.4 1.508 0.4 c 0.5712 0 1.096 -0.1496 1.508 -0.4 H 5.3 c 0.276 0 0.5 0.224 0.5 0.5 v 0.3 h 0.4 v -0.3 c 0 -0.4056 -0.2696 -0.7496 -0.64 -0.8616 c 0.0712 -0.0752 0.1344 -0.1552 0.1896 -0.2384 H 6.3 c 0.276 0 0.5 0.224 0.5 0.5 v 0.5 h 0.4 v -0.5 c 0 -0.496 -0.404 -0.9 -0.9 -0.9 h -0.3592 c 0.0392 -0.1288 0.0592 -0.2624 0.0592 -0.4 h 0.3 c 0.496 0 0.9 -0.404 0.9 -0.9 v -0.5 h -0.4 V 3.6504 z',
              'M 2.3226 7.7602 c -0.0196 -0.0182 -0.0196 -0.0224 -0.0084 -0.0798 c 0.0028 -0.0098 -0.0014 -0.0224 -0.0056 -0.028 c -0.014 -0.0168 -0.0112 -0.1022 0.007 -0.1596 c 0.0182 -0.056 0.1288 -0.2856 0.2478 -0.5068 c 0.0448 -0.0826 0.105 -0.196 0.1344 -0.252 c 0.0294 -0.056 0.0728 -0.1386 0.0966 -0.182 c 0.0756 -0.1442 0.3192 -0.6314 0.3752 -0.7518 c 0.1204 -0.2618 0.1484 -0.3472 0.1414 -0.4228 c -0.0112 -0.105 -0.0728 -0.1582 -0.2674 -0.2282 c -0.539 -0.196 -1.169 -0.5208 -1.617 -0.8316 c -0.3654 -0.2548 -0.5782 -0.4774 -0.6244 -0.6566 c -0.0154 -0.0588 -0.0112 -0.1316 0.0112 -0.175 c 0.0182 -0.0392 0.0476 -0.0728 0.056 -0.0672 c 0.0042 0.0028 0.0112 -0.0014 0.0168 -0.0084 c 0.0098 -0.0112 0.0084 -0.0112 -0.0042 -0.0014 c -0.0126 0.0084 -0.0126 0.0084 -0.0056 0 c 0.0056 -0.0056 0.0126 -0.0112 0.0154 -0.0112 c 0.0042 -0.0014 0.0112 -0.0014 0.0154 -0.0028 c 0.0042 0 0.0056 -0.0056 0.0028 -0.0098 c -0.0028 -0.0056 -0.0028 -0.007 0 -0.0056 c 0.0028 0.0028 0.0266 -0.0028 0.0518 -0.0112 c 0.0812 -0.028 0.1596 -0.0336 0.35 -0.0294 c 0.2548 0.0056 0.4928 0.035 0.896 0.1078 c 0.0742 0.014 0.1386 0.0224 0.1428 0.0196 c 0.0056 -0.0042 0.0056 -0.0028 0.0028 0.0042 c -0.0042 0.007 -0.0014 0.0084 0.014 0.0056 c 0.0098 -0.0028 0.021 -0.0014 0.0224 0.0028 c 0.0028 0.0042 0.0126 0.0056 0.0224 0.0028 c 0.0126 -0.0028 0.0154 -0.0014 0.0126 0.0042 c -0.0042 0.0056 0.0028 0.007 0.0168 0.0056 c 0.0126 -0.0028 0.0224 -0.0014 0.0224 0.0042 c 0 0.0042 0.0084 0.0056 0.0182 0.0028 c 0.0126 -0.0042 0.0168 -0.0028 0.014 0.0042 c -0.0042 0.0056 0.0014 0.007 0.0182 0.0028 c 0.0168 -0.0042 0.0224 -0.0028 0.0182 0.0028 c -0.0042 0.0056 0.0014 0.007 0.0154 0.0042 c 0.014 -0.0042 0.0182 -0.0028 0.014 0.0042 c -0.0042 0.007 -0.0014 0.007 0.0098 0.0042 c 0.021 -0.007 0.0686 0.0028 0.056 0.0112 c -0.0056 0.0042 0 0.0056 0.014 0.0028 c 0.0154 -0.0028 0.0224 -0.0028 0.0224 0.0042 c 0 0.0056 0.0028 0.007 0.007 0.0042 c 0.0112 -0.007 0.0574 0.0042 0.0518 0.0126 c -0.0028 0.0042 -0.0014 0.0056 0.0042 0.0028 c 0.0112 -0.007 0.0658 0.0028 0.0602 0.0112 c -0.0028 0.0042 0.0014 0.0042 0.007 0.0028 c 0.021 -0.0084 0.4228 0.098 0.8092 0.2142 c 0.1134 0.035 0.21 0.0448 0.2534 0.0252 c 0.0308 -0.014 0.0518 -0.0392 0.063 -0.0756 c 0.007 -0.0266 0.0098 -0.1904 0.0042 -0.2282 c -0.0224 -0.1358 -0.0294 -0.91 -0.0126 -1.2908 c 0.0252 -0.5656 0.0742 -1.029 0.1288 -1.2068 c 0.0224 -0.0728 0.0602 -0.1386 0.0994 -0.1722 c 0.0182 -0.0168 0.0364 -0.0294 0.0392 -0.0308 c 0.0042 0 0.0182 -0.0126 0.0322 -0.0266 c 0.0238 -0.0224 0.0308 -0.0266 0.0602 -0.0266 c 0.1876 0 0.5516 0.5614 0.7882 1.2166 c 0.119 0.329 0.1932 0.6328 0.2338 0.9576 c 0.0182 0.1414 0.0182 0.4802 0 0.5922 c -0.0112 0.07 -0.0406 0.2128 -0.0518 0.2548 c -0.0028 0.0112 -0.0028 0.0112 0.0028 0.0042 c 0.0056 -0.0084 0.0098 -0.0084 0.0238 0.0028 c 0.0392 0.028 0.1148 0.0112 0.294 -0.0672 c 0.294 -0.1274 0.4746 -0.182 0.7742 -0.2366 c 0.3556 -0.0644 0.7728 -0.0784 1.1354 -0.035 c 0.0434 0.0056 0.07 0.0112 0.0672 0.0154 c -0.0028 0.0042 0.0056 0.0056 0.0224 0.0028 c 0.0154 -0.0028 0.0238 -0.0014 0.0224 0.0028 c -0.0028 0.0042 0.0056 0.007 0.0168 0.007 c 0.0308 0 0.1512 0.0252 0.2604 0.0532 c 0.2506 0.0658 0.3962 0.1554 0.4172 0.2604 c 0.0126 0.0574 -0.0742 0.1456 -0.2352 0.2394 c -0.0294 0.0168 -0.0546 0.0322 -0.056 0.035 c -0.0056 0.007 -0.0686 0.042 -0.0756 0.042 c -0.0042 0 -0.0546 0.0252 -0.112 0.056 c -0.0574 0.0308 -0.112 0.0574 -0.1204 0.0602 c -0.0084 0.0014 -0.0294 0.0112 -0.049 0.021 c -0.0182 0.0098 -0.0644 0.0308 -0.1036 0.0476 c -0.0392 0.0168 -0.098 0.0434 -0.1316 0.0602 c -0.0336 0.0168 -0.0644 0.0308 -0.07 0.0308 c -0.0042 0 -0.0728 0.0266 -0.1498 0.0602 c -0.0784 0.0336 -0.1442 0.0602 -0.147 0.0602 c -0.0028 0 -0.0112 0.0042 -0.0168 0.0098 c -0.007 0.0056 -0.0406 0.0196 -0.077 0.0322 c -0.0364 0.0126 -0.077 0.028 -0.091 0.0364 c -0.014 0.007 -0.0294 0.014 -0.0336 0.014 c -0.0126 0 -0.1246 0.0434 -0.1806 0.07 c -0.0252 0.0126 -0.0574 0.0238 -0.07 0.0266 c -0.0126 0.0028 -0.0308 0.0098 -0.0434 0.0168 c -0.0112 0.007 -0.035 0.0168 -0.0518 0.021 c -0.0434 0.0126 -0.1834 0.0644 -0.1932 0.0714 c -0.0098 0.007 -0.063 0.028 -0.0854 0.0308 c -0.0238 0.0042 -0.1288 0.0448 -0.1386 0.0518 c -0.0042 0.0042 -0.0252 0.0112 -0.0476 0.0168 c -0.0224 0.0056 -0.063 0.0196 -0.091 0.0294 c -0.084 0.0308 -0.1638 0.0602 -0.1652 0.0602 c -0.0014 0 -0.0014 0.0028 0.0014 0.007 c 0.0028 0.0028 -0.0042 0.0126 -0.014 0.0224 c -0.0196 0.0182 -0.0308 0.0476 -0.0336 0.0896 c -0.0014 0.0294 0.0042 0.0364 0.1554 0.245 c 0.7784 1.0626 1.2418 1.7962 1.3048 2.0692 c 0.0126 0.0504 0.014 0.091 0.0042 0.1106 c -0.0154 0.0266 -0.091 0.0546 -0.1876 0.0686 c -0.0686 0.0112 -0.2604 0.0112 -0.3164 0.0014 c -0.2478 -0.0448 -0.5054 -0.1624 -0.8218 -0.3766 c -0.0658 -0.0434 -0.1218 -0.0826 -0.126 -0.0868 c -0.0056 -0.0042 -0.0462 -0.0364 -0.0924 -0.0714 c -0.2324 -0.1778 -0.5376 -0.4564 -0.714 -0.6496 c -0.0238 -0.0252 -0.0588 -0.063 -0.0784 -0.084 c -0.0196 -0.021 -0.0616 -0.07 -0.0938 -0.1078 c -0.0784 -0.0938 -0.1372 -0.154 -0.175 -0.1806 c -0.0308 -0.021 -0.0784 -0.0392 -0.0994 -0.0364 c -0.0056 0.0014 -0.0154 0.0014 -0.0224 0.0028 c -0.007 0.0014 -0.0196 0.0196 -0.0308 0.049 c -0.0378 0.0896 -0.1414 0.2996 -0.1862 0.3766 c -0.1456 0.252 -0.2884 0.4396 -0.4872 0.637 c -0.1554 0.1554 -0.182 0.1778 -0.2982 0.2632 c -0.0448 0.0322 -0.0882 0.0658 -0.0966 0.0728 c -0.0084 0.0084 -0.0322 0.0252 -0.0518 0.0364 c -0.021 0.0126 -0.0616 0.0364 -0.0924 0.0546 c -0.0826 0.0476 -0.2632 0.1386 -0.3402 0.1694 c -0.0364 0.0154 -0.0686 0.0294 -0.07 0.0308 c -0.0028 0.0028 -0.0182 0.0084 -0.035 0.014 c -0.0182 0.0042 -0.0532 0.0154 -0.0812 0.0224 c -0.0266 0.0084 -0.056 0.0154 -0.063 0.0182 c -0.0084 0.0014 -0.0238 0.0084 -0.035 0.0126 c -0.0126 0.0056 -0.0462 0.0112 -0.0756 0.014 c -0.0294 0.0028 -0.0616 0.007 -0.0714 0.0112 c -0.0336 0.0126 -0.07 0.0084 -0.0896 -0.0098 z',
              'M 5.5368 3.6 c 0.1592 0 0.288 -0.1288 0.288 -0.288 v -0.7256 l 0.196 -0.1 c 0.0712 -0.036 0.1584 -0.1224 0.1952 -0.1928 l 0.172 -0.3256 c 0.0368 -0.0704 0.0136 -0.1632 -0.052 -0.208 l -0.6448 -0.4336 C 5.4064 0.5968 4.7 0.08 3.8712 0.08 c -0.7968 0 -1.4808 0.4776 -1.7848 1.1624 l -0.7688 0.5176 c -0.0664 0.044 -0.0896 0.1376 -0.052 0.208 l 0.172 0.3256 c 0.0368 0.0704 0.1248 0.1568 0.1952 0.1928 l 0.2856 0.1456 v 0.68 c 0 0.1592 0.1288 0.288 0.288 0.288 h 0.2968 v 1.4216 c -0.0064 0.0248 -0.0104 0.052 -0.0088 0.0816 c 0.0224 0.6616 -0.7008 0.8376 -1.104 1.2368 c -0.264 0.2616 0.1432 0.6688 0.4072 0.4072 c 0.2528 -0.2504 0.5752 -0.408 0.8504 -0.6296 c 0.188 -0.1512 0.3056 -0.3488 0.368 -0.5664 c 0.0848 0.6032 0.4048 1.1504 0.432 1.7848 c 0.016 0.3704 0.5928 0.3712 0.576 0 c -0.032 -0.7232 -0.536 -1.4224 -0.4568 -2.1424 h 0.3232 c -0.1312 0.2688 -0.1648 0.5616 -0.0552 0.892 c 0.1832 0.5496 0.7256 0.9472 0.7288 1.5568 c 0.0024 0.3712 0.5784 0.3712 0.576 0 c -0.0024 -0.4144 -0.1656 -0.7584 -0.3848 -1.1024 C 4.448 6.056 4.1608 5.6848 4.5816 5.1928 h 0.08 c 0.0584 0.4464 0.4208 0.724 0.7848 0.964 c 0.432 0.2848 0.9552 0.5224 0.596 1.0864 c -0.2 0.3144 0.2984 0.6032 0.4976 0.2912 c 0.3264 -0.512 0.2832 -1.0296 -0.176 -1.4368 c -0.284 -0.252 -1.0408 -0.5224 -1.1256 -0.9432 V 3.6 L 5.5368 3.6 L 5.5368 3.6 z',
            ],
          },
        ],
        axes: [
          {
            orient: 'bottom',
            scale: 'x',
            domain: false,
            title: this.xTitle,
            labelOverlap: 'parity',
          },
          {
            orient: 'left',
            scale: 'y',
            domain: false,
            title: this.yTitle,
          },
        ],
        legends: [
          {
            title: ['Abundance of', 'Fish (log)'],
            fill: 'color',
            type: 'gradient',
            gradientLength: { signal: 'height' },
          },
        ],
        marks: [
          {
            type: 'symbol',
            from: { data: 'data' },
            encode: {
              enter: {
                tooltip: {
                  signal:
                    "{'Year': datum.year, 'Species': datum.species, 'Count': datum.abun}",
                },
              },
              update: {
                yc: { signal: "scale('y', datum.species) + bandwidth('y')/3" },
                xc: { signal: "scale('x', datum.year) + bandwidth('x')/3" },
                fill: { scale: 'color', field: 'abun' },
                shape: { scale: 'shape', field: 'animal' },
                width: { signal: "bandwidth('x') * scale('size', datum.abun)" },
                height: {
                  signal: "bandwidth('y') * scale('size', datum.abun)",
                },
                size: { signal: "scale('size', datum.abun) * bandwidth('x')" },
              },
            },
          },
        ],
      };
    },
  },
};
</script>

<style lang="scss" scoped></style>
